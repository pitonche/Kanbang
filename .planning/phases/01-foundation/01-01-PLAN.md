---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/schema.ts
  - package.json
  - bun.lockb
autonomous: true

must_haves:
  truths:
    - "Convex schema exists with tasks table containing all required fields (title, notes, column, cadence, priority, createdAt, updatedAt, completedAt, archivedAt, searchText)"
    - "Tasks table has by_column database index and search_text search index"
    - "App runs locally via bun run dev with Convex backend connected and no errors"
  artifacts:
    - path: "convex/schema.ts"
      provides: "Task table schema with validators, indexes, and search index"
      contains: "defineSchema"
    - path: "package.json"
      provides: "Project dependencies and scripts"
      contains: "convex"
    - path: "bun.lockb"
      provides: "Bun lockfile confirming bun is the package manager"
  key_links:
    - from: "convex/schema.ts"
      to: "Convex backend"
      via: "convex dev syncs schema to cloud"
      pattern: "defineSchema.*defineTable"
---

<objective>
Scaffold the Kanbang project from the official Convex React+Vite template, switch to bun as package manager, and replace the demo schema with the complete Kanbang tasks schema including all fields and indexes needed across all 6 phases.

Purpose: Establish the project foundation with the correct data model from day one, preventing schema migrations in later phases.
Output: Working Convex+React+Vite project with complete tasks schema deployed to Convex backend.
</objective>

<execution_context>
@/Users/ciciban/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ciciban/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold project from Convex template and install with bun</name>
  <files>package.json, bun.lockb, vite.config.ts, tsconfig.json, tsconfig.app.json, index.html, src/main.tsx, src/App.tsx, src/index.css, convex/schema.ts, convex/myFunctions.ts</files>
  <action>
Run the Convex React+Vite template scaffolding command from the project root's PARENT directory. The project should be created in the current working directory (which is already named "Kanbang"):

1. Check if the current directory is empty or only has `.planning/` and `.git/`. If so, scaffold INTO the current directory. If the template command requires a directory name, use a temp name and move files up.

Strategy: Run `npm create convex@latest -- -t react-vite temp-scaffold` in the project root, then move all files from `temp-scaffold/` into the project root, then remove `temp-scaffold/`. This preserves the existing `.planning/` directory.

2. After scaffolding, switch to bun:
   - Delete `package-lock.json` if it exists
   - Run `bun install`

3. Verify the template created the expected files: `package.json`, `vite.config.ts`, `src/main.tsx`, `src/App.tsx`, `src/index.css`, `convex/schema.ts`

IMPORTANT: Use `bun` as the package manager per user decision. The `npm create convex` command itself uses npm (it is an npm initializer), but all subsequent operations use bun.

NOTE: On first run, `bunx convex dev` will require Convex authentication. If auth fails or prompts appear, pause and let the user handle the login flow. After auth, `bun run dev` will work normally.
  </action>
  <verify>
- `ls package.json bun.lockb vite.config.ts src/main.tsx convex/schema.ts` all exist
- `bun run build` completes without errors (confirms TypeScript + Vite + Tailwind all wired)
- `.planning/` directory still intact
  </verify>
  <done>Project scaffolded from Convex template with bun as package manager. All template files present. Build succeeds.</done>
</task>

<task type="auto">
  <name>Task 2: Replace template schema with complete Kanbang tasks schema</name>
  <files>convex/schema.ts</files>
  <action>
Replace the contents of `convex/schema.ts` with the complete Kanbang tasks table schema. The schema defines ALL fields needed across all 6 phases (not just Phase 1), preventing future migrations.

Write this exact schema:

```typescript
import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export default defineSchema({
  tasks: defineTable({
    // Core fields
    title: v.string(),
    notes: v.optional(v.string()),

    // Board position
    column: v.union(
      v.literal("inbox"),
      v.literal("backlog"),
      v.literal("in_progress"),
      v.literal("needs_info"),
      v.literal("blocked"),
      v.literal("done"),
    ),

    // Task metadata
    cadence: v.union(
      v.literal("daily"),
      v.literal("weekly"),
      v.literal("monthly"),
      v.literal("none"),
    ),
    priority: v.union(
      v.literal("low"),
      v.literal("medium"),
      v.literal("high"),
    ),

    // Timestamps (milliseconds since epoch via Date.now())
    createdAt: v.number(),
    updatedAt: v.number(),
    completedAt: v.optional(v.number()),
    archivedAt: v.optional(v.number()),

    // Composite search field (title + notes, computed at write time)
    searchText: v.string(),
  })
    // Database index: query tasks by column (for board rendering)
    .index("by_column", ["column"])
    // Full-text search index: search across title+notes via searchText
    .searchIndex("search_text", {
      searchField: "searchText",
      filterFields: ["column"],
    }),
});
```

Key design decisions:
- `column` uses snake_case literal unions (`in_progress`, not "In Progress") per research findings
- `notes`, `completedAt`, `archivedAt` are optional (not all tasks have them)
- `searchText` is required string (computed as `title + " " + (notes ?? "")` at write time in later phases)
- `by_column` index supports efficient board rendering queries
- `search_text` search index with `filterFields: ["column"]` supports scoped search in later phases
- Timestamps use `v.number()` storing `Date.now()` milliseconds (Convex has no Date type)

After writing the schema, run `bun run build` to verify TypeScript compilation succeeds with the new schema.
  </action>
  <verify>
- `convex/schema.ts` contains `defineSchema` with `tasks` table
- Schema has all 10 fields: title, notes, column, cadence, priority, createdAt, updatedAt, completedAt, archivedAt, searchText
- Schema has `.index("by_column", ["column"])` and `.searchIndex("search_text", ...)`
- `bun run build` succeeds
  </verify>
  <done>Convex schema defines tasks table with all fields needed across all phases, plus by_column index and search_text search index. Build passes.</done>
</task>

</tasks>

<verification>
1. `ls package.json bun.lockb vite.config.ts tsconfig.json convex/schema.ts src/main.tsx src/App.tsx src/index.css` -- all files exist
2. `grep -c "defineSchema\|defineTable\|by_column\|search_text\|searchText\|title\|notes\|column\|cadence\|priority\|createdAt\|updatedAt\|completedAt\|archivedAt" convex/schema.ts` -- all fields and indexes present
3. `bun run build` -- exits 0 with no TypeScript errors
4. `.planning/` directory still intact with CONTEXT.md, RESEARCH.md, and PLAN files
</verification>

<success_criteria>
- Project scaffolded from `npm create convex` template with React+Vite+TypeScript+Tailwind v4
- Bun is the package manager (bun.lockb exists, no package-lock.json)
- Convex schema defines tasks table with all 10 fields, by_column index, and search_text search index
- `bun run build` succeeds with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
