---
phase: 04-search-and-filters
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/CadenceFilter.tsx
  - src/components/Board.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can click Today / This Week / This Month buttons to filter the board by cadence"
    - "Clicking an active filter button toggles it off, showing all tasks again"
    - "Search and cadence filter are mutually exclusive -- starting search clears filter, clicking filter clears search"
    - "Pressing / focuses the search input when not already in an input field"
  artifacts:
    - path: "src/components/CadenceFilter.tsx"
      provides: "Three toggle buttons for cadence filtering"
      exports: ["CadenceFilter"]
    - path: "src/components/Board.tsx"
      provides: "Cadence filter state, mutual exclusion with search, toolbar integration"
    - path: "src/App.tsx"
      provides: "/ keyboard shortcut to focus search input"
  key_links:
    - from: "src/components/Board.tsx"
      to: "src/components/CadenceFilter.tsx"
      via: "CadenceFilter rendered in toolbar with active/onFilter props"
      pattern: "<CadenceFilter"
    - from: "src/components/Board.tsx"
      to: "Object.groupBy"
      via: "Client-side filter applied before column grouping"
      pattern: "filter.*cadence.*groupBy"
    - from: "src/App.tsx"
      to: "src/components/Board.tsx"
      via: "searchInputRef forwarded via Board prop or callback for / shortcut focus"
      pattern: "searchInputRef|focusSearch"
---

<objective>
Add cadence quick-filter buttons (Today / This Week / This Month) to the toolbar and wire up the "/" keyboard shortcut to focus the search input.

Purpose: Enables SRCH-03 (filter by cadence via quick-filter buttons). Also adds the "/" search focus shortcut for fast keyboard-driven workflow.
Output: CadenceFilter component, Board.tsx updated with cadence filtering and mutual exclusion, App.tsx updated with "/" shortcut.
</objective>

<execution_context>
@/Users/ciciban/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ciciban/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-search-and-filters/04-RESEARCH.md
@.planning/phases/04-search-and-filters/04-01-SUMMARY.md
@src/components/Board.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CadenceFilter component</name>
  <files>src/components/CadenceFilter.tsx</files>
  <action>
Create `src/components/CadenceFilter.tsx` with three toggle buttons:

```tsx
const CADENCE_FILTERS = [
  { value: "daily", label: "Today" },
  { value: "weekly", label: "This Week" },
  { value: "monthly", label: "This Month" },
] as const;

interface CadenceFilterProps {
  active: string | null;
  onFilter: (cadence: string | null) => void;
  disabled?: boolean;
}

export function CadenceFilter({ active, onFilter, disabled }: CadenceFilterProps) {
  return (
    <div className="flex gap-2">
      {CADENCE_FILTERS.map((f) => (
        <button
          key={f.value}
          onClick={() => onFilter(active === f.value ? null : f.value)}
          disabled={disabled}
          className={`px-3 py-1.5 text-xs font-medium rounded-full border transition-colors ${
            active === f.value
              ? "bg-slate-700 text-white border-slate-700"
              : "bg-white text-slate-600 border-slate-300 hover:border-slate-400"
          } ${disabled ? "opacity-50 cursor-not-allowed" : ""}`}
        >
          {f.label}
        </button>
      ))}
    </div>
  );
}
```

Key details:
- Toggle behavior: clicking the active filter again sets it to null (clears)
- `disabled` prop used when search is active (grayed out, cursor-not-allowed)
- Active state uses slate-700 bg with white text; inactive is white bg with slate border
- Rounded-full pill shape for filter buttons (visually distinct from board elements)
- Uses same Slate palette as the rest of the app
  </action>
  <verify>
Run `npx tsc --noEmit`. The component should compile without errors.
  </verify>
  <done>
CadenceFilter component exists with three toggle buttons (Today, This Week, This Month). Accepts `active`, `onFilter`, and `disabled` props. Toggle behavior and disabled styling implemented.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate cadence filter into Board and add "/" shortcut to App</name>
  <files>src/components/Board.tsx, src/App.tsx</files>
  <action>
**1. Update `src/components/Board.tsx`:**

Add import:
```typescript
import { CadenceFilter } from "./CadenceFilter";
```

Add cadence filter state after the search state (added in Plan 04-01):
```typescript
const [cadenceFilter, setCadenceFilter] = useState<string | null>(null);
```

Add mutual exclusion handlers. Create two wrapper functions:

```typescript
function handleSearchChange(value: string) {
  setSearchTerm(value);
  if (value.trim()) {
    setCadenceFilter(null); // Clear cadence filter when user starts searching
  }
}

function handleCadenceFilter(cadence: string | null) {
  setCadenceFilter(cadence);
  setSearchTerm(""); // Clear search when user clicks a cadence filter
}
```

Replace the direct `setSearchTerm` passed to SearchBar with `handleSearchChange`:
```tsx
<SearchBar value={searchTerm} onChange={handleSearchChange} />
```

Apply cadence filter to tasks before column grouping. Change the existing `tasksByColumn` line:
```typescript
// Filter tasks by cadence before grouping into columns
const filteredTasks = cadenceFilter
  ? typedTasks.filter((t) => t.cadence === cadenceFilter)
  : typedTasks;

const tasksByColumn = Object.groupBy(filteredTasks, (t) => t.column);
```

IMPORTANT: Also update `selectedTask` to search in `typedTasks` (not `filteredTasks`) so that clicking a task card can still find the task even if filter changes:
```typescript
const selectedTask = typedTasks.find((t) => t._id === selectedTaskId) ?? null;
```
(This line should already be correct from the existing code -- just verify it uses `typedTasks`, not `filteredTasks`.)

Add CadenceFilter to the toolbar (after SearchBar):
```tsx
<div className="flex items-center gap-4 px-6 pt-4 pb-2">
  <SearchBar value={searchTerm} onChange={handleSearchChange} />
  <CadenceFilter
    active={cadenceFilter}
    onFilter={handleCadenceFilter}
    disabled={isSearchActive}
  />
</div>
```

The `disabled={isSearchActive}` grays out the cadence buttons when search is active, reinforcing mutual exclusion visually.

Add a ref for focusing the search input from outside. Export a `searchInputRef` or use a callback approach. The simplest: add a prop `searchInputRef` to Board that gets passed to SearchBar:

In Board's function signature, accept an optional ref:
```typescript
export function Board({ onSearchInputRef }: { onSearchInputRef?: (el: HTMLInputElement | null) => void }) {
```

Pass it through to SearchBar:
```tsx
<SearchBar value={searchTerm} onChange={handleSearchChange} inputRef={onSearchInputRef} />
```

Update SearchBar to accept and apply the ref. In `src/components/SearchBar.tsx`, add an `inputRef` prop:
```typescript
interface SearchBarProps {
  value: string;
  onChange: (value: string) => void;
  inputRef?: (el: HTMLInputElement | null) => void;
}
```

And on the input element:
```tsx
<input ref={inputRef} ... />
```

**2. Update `src/App.tsx`:**

Add `useRef` and `useCallback` to the React import:
```typescript
import { useState, useEffect, useRef } from "react";
```

Add a ref to store the search input element:
```typescript
const searchInputRef = useRef<HTMLInputElement | null>(null);
```

Add "/" keyboard shortcut in the existing `handleKeyDown` function, alongside the "n"/"N" handler:
```typescript
if (e.key === "/") {
  e.preventDefault();
  searchInputRef.current?.focus();
}
```

This should go after the existing guards (input/textarea/dialog/modifier checks) and before or alongside the "n"/"N" check.

Pass the ref callback to Board:
```tsx
<Board onSearchInputRef={(el) => { searchInputRef.current = el; }} />
```

The complete keyboard shortcut handler in the useEffect should now handle both "n"/"N" and "/".
  </action>
  <verify>
Run `npx tsc --noEmit` to verify type safety. Then run `bun run dev` and verify in the browser:
1. Three filter buttons (Today, This Week, This Month) appear in the toolbar next to the search bar
2. Clicking "Today" filters the board to show only daily-cadence tasks
3. Clicking "Today" again clears the filter (toggle off)
4. When a cadence filter is active, typing in search clears the filter
5. When search is active, cadence filter buttons are grayed out / disabled
6. Clicking a cadence filter button when search has text clears the search
7. Pressing "/" from anywhere on the board focuses the search input
8. "N" shortcut still works for QuickAdd
9. Drag and drop still works when cadence filter is active
  </verify>
  <done>
CadenceFilter renders in the toolbar. Clicking a filter shows only tasks with matching cadence on the board. Search and filter are mutually exclusive. "/" shortcut focuses the search input. All existing functionality (drag-and-drop, N shortcut, TaskModal) continues to work.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `bun run build` succeeds
3. Three cadence filter buttons visible in toolbar next to search bar
4. Clicking "Today" filters board to daily tasks only; columns may be empty if no daily tasks
5. Clicking active filter button toggles it off, restoring all tasks
6. Typing in search input clears any active cadence filter
7. Clicking a cadence filter button clears search input text
8. Cadence filter buttons are visually disabled (grayed) when search is active
9. "/" keyboard shortcut focuses the search input from anywhere on the page
10. "N" keyboard shortcut still opens QuickAdd
11. Drag and drop works correctly when cadence filter is active
</verification>

<success_criteria>
- CadenceFilter component renders three toggle buttons with correct active/inactive styling
- Board filters tasks client-side by cadence value before column grouping
- Search and cadence filter are mutually exclusive (one clears the other)
- "/" keyboard shortcut focuses the search input
- All existing Phase 1-3 functionality remains intact
- Build compiles and app runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-search-and-filters/04-02-SUMMARY.md`
</output>
