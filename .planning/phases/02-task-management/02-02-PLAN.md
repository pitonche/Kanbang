---
phase: 02-task-management
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/TaskModal.tsx
  - src/components/QuickAdd.tsx
  - src/components/Board.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can click a task card to open a detail modal showing all task fields"
    - "User can edit title, notes, cadence, and priority in the modal and see changes on the board"
    - "User can delete a task from the modal and it disappears from the board"
    - "User can press N anywhere on the board to open a quick-add form with cursor in the title field"
    - "Quick-add creates a new task that appears in the Inbox column"
  artifacts:
    - path: "src/components/TaskModal.tsx"
      provides: "Task detail/edit modal with delete button using native dialog element"
      contains: "dialog"
    - path: "src/components/QuickAdd.tsx"
      provides: "Quick-add form for creating tasks with title field"
      contains: "autofocus"
    - path: "src/App.tsx"
      provides: "Global N keyboard shortcut listener"
      contains: "keydown"
  key_links:
    - from: "src/components/TaskModal.tsx"
      to: "convex/tasks.ts"
      via: "useMutation(api.tasks.update) and useMutation(api.tasks.remove)"
      pattern: "useMutation.*api\\.tasks\\.(update|remove)"
    - from: "src/components/QuickAdd.tsx"
      to: "convex/tasks.ts"
      via: "useMutation(api.tasks.create)"
      pattern: "useMutation.*api\\.tasks\\.create"
    - from: "src/components/Board.tsx"
      to: "src/components/TaskModal.tsx"
      via: "renders TaskModal with selected task"
      pattern: "TaskModal"
    - from: "src/App.tsx"
      to: "src/components/QuickAdd.tsx"
      via: "N keydown toggles QuickAdd open state"
      pattern: "setQuickAddOpen"
---

<objective>
Build the task detail modal for viewing, editing, and deleting tasks, plus the quick-add form with "N" keyboard shortcut for rapid task creation.

Purpose: Completes the full task CRUD experience. Users can now create tasks instantly with N, click cards to edit all fields in a modal, and delete tasks they no longer need. This makes the board a fully functional tool for capturing and organizing work.

Output: `TaskModal.tsx` dialog component for edit/delete, `QuickAdd.tsx` form for creating tasks, App.tsx updated with N keyboard shortcut.
</objective>

<execution_context>
@/Users/ciciban/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ciciban/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-task-management/02-RESEARCH.md
@.planning/phases/02-task-management/02-01-SUMMARY.md
@convex/schema.ts
@convex/tasks.ts
@src/components/Board.tsx
@src/components/TaskCard.tsx
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TaskModal for viewing, editing, and deleting tasks</name>
  <files>src/components/TaskModal.tsx, src/components/Board.tsx</files>
  <action>
**TaskModal.tsx** — Create a modal component using the native HTML `<dialog>` element:

Props: `{ task: Doc<"tasks"> | null; onClose: () => void }`. Import `Doc` from `../convex/_generated/dataModel`.

**Dialog lifecycle:**
- Use `useRef<HTMLDialogElement>(null)` for the dialog reference.
- In a `useEffect` keyed on `[task]`: if `task` is non-null and dialog is not open, call `dialogRef.current.showModal()`. If `task` is null and dialog is open, call `dialogRef.current.close()`.
- Attach `onClose={onClose}` on the `<dialog>` element so Escape key syncs React state.
- Style the dialog: `className="rounded-lg p-0 backdrop:bg-black/50 max-w-lg w-full"`.

**Form state:**
- Use local `useState` for each field: title (string), notes (string), cadence (enum), priority (enum).
- In a `useEffect` keyed on `[task]`: when task changes, populate form state from task fields (title, notes ?? "", cadence, priority).

**Form layout:**
- Title: `<input type="text" />` with label, required, `className="w-full border border-slate-300 rounded px-3 py-2 text-sm"`.
- Notes: `<textarea />` with label, 3 rows, same border styling.
- Cadence: `<select>` with options: daily, weekly, monthly, none. Label "Cadence".
- Priority: `<select>` with options: low, medium, high. Label "Priority".
- All form elements use controlled values from useState.

**Save action:**
- Import `useMutation` from `convex/react` and `api` from `../convex/_generated/api`.
- `const updateTask = useMutation(api.tasks.update)`.
- On form submit (or "Save" button click): call `updateTask({ id: task._id, title, notes: notes || undefined, cadence, priority })`. Then call `onClose()`.
- Trim title before saving. If title is empty after trim, don't save (basic validation).

**Delete action:**
- `const removeTask = useMutation(api.tasks.remove)`.
- Add a "Delete" button styled with red text (`text-red-600 hover:text-red-800`).
- On click: call `removeTask({ id: task._id })` then `onClose()`. No confirmation dialog needed for MVP.

**Button layout:**
- Bottom of modal: flex row with "Delete" on the left (red), "Cancel" and "Save" on the right.
- Cancel calls `onClose()`.
- Save submits the form.

**Board.tsx** — Wire the modal:
- The `selectedTaskId` state already exists from Plan 02-01.
- Derive the full task object: `const selectedTask = tasks?.find(t => t._id === selectedTaskId) ?? null`.
- Render `<TaskModal task={selectedTask} onClose={() => setSelectedTaskId(null)} />` after the columns div.
- Import TaskModal.
  </action>
  <verify>
Run `bun run build` — should pass. Verify TaskModal.tsx exists and contains `<dialog`, `showModal`, `useMutation(api.tasks.update)`, `useMutation(api.tasks.remove)`. Verify Board.tsx renders `<TaskModal`.
  </verify>
  <done>
Clicking a task card opens a modal dialog showing title, notes, cadence, and priority fields. User can edit any field and save (reflected on board via Convex reactivity). User can delete a task from the modal. Escape key or Cancel button closes the modal. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create QuickAdd form and wire N keyboard shortcut</name>
  <files>src/components/QuickAdd.tsx, src/App.tsx, src/components/Board.tsx</files>
  <action>
**QuickAdd.tsx** — Create a quick-add component using native `<dialog>`:

Props: `{ open: boolean; onClose: () => void }`.

**Dialog lifecycle:**
- Use `useRef<HTMLDialogElement>(null)`.
- `useEffect` on `[open]`: if open and dialog not open, call `showModal()`. If not open and dialog is open, call `close()`.
- `onClose={onClose}` on dialog element.

**Form:**
- Single text input for title with `autoFocus` attribute so cursor is focused immediately when dialog opens.
- Input styling: `className="w-full border border-slate-300 rounded px-3 py-2 text-sm"` with placeholder "Task title...".
- Local `useState` for title string, initialized to "".

**Submit behavior:**
- Import `useMutation` from `convex/react` and `api` from `../convex/_generated/api`.
- `const createTask = useMutation(api.tasks.create)`.
- On form submit (Enter key): trim title, if non-empty call `createTask({ title: trimmedTitle, cadence: "none", priority: "medium" })`. Defaults: cadence "none", priority "medium" (user can change later via the detail modal).
- After successful create: clear the title input, close the dialog via `onClose()`.
- On Escape: dialog closes via native behavior, `onClose` fires, reset title to "".

**Dialog styling:**
- `className="rounded-lg p-4 backdrop:bg-black/50 max-w-md w-full"`.
- Include a small header: `<h3 className="text-sm font-semibold text-slate-700 mb-2">Quick Add Task</h3>`.
- Submit button: `<button type="submit" className="mt-3 w-full bg-slate-700 text-white rounded px-3 py-2 text-sm hover:bg-slate-800">Add Task</button>`.

**App.tsx** — Wire the N keyboard shortcut:
- Import `useState`, `useEffect` from React.
- Import `QuickAdd` from `./components/QuickAdd`.
- Add state: `const [quickAddOpen, setQuickAddOpen] = useState(false)`.
- Add `useEffect` with `keydown` listener on `document`:
  - Check `e.target` — if tagName is "INPUT", "TEXTAREA", or `isContentEditable`, return early.
  - Check `e.target` — if it's inside a `<dialog>` element (use `(e.target as HTMLElement).closest("dialog")`), return early (don't trigger shortcut while in a modal).
  - If `e.metaKey || e.ctrlKey || e.altKey`, return early.
  - If `e.key === "n" || e.key === "N"`: call `e.preventDefault()` and `setQuickAddOpen(true)`.
- Render: `<QuickAdd open={quickAddOpen} onClose={() => setQuickAddOpen(false)} />` alongside `<Board />`.

**Board.tsx** — No changes needed for this task (QuickAdd lives in App.tsx above Board).
  </action>
  <verify>
Run `bun run build` — should pass. Verify QuickAdd.tsx exists and contains `<dialog`, `showModal`, `autoFocus`, `useMutation(api.tasks.create)`. Verify App.tsx contains `keydown` listener checking for "n" key and renders `<QuickAdd`. Verify App.tsx guards against firing shortcut in input fields and inside dialogs.
  </verify>
  <done>
Pressing "N" anywhere on the board (when not in an input field or modal) opens the quick-add dialog with cursor focused in the title field. Typing a title and pressing Enter creates a new task in the Inbox column with default cadence "none" and priority "medium". The dialog closes after creation. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `bun run build` passes with zero errors
2. `src/components/TaskModal.tsx` exists with native dialog, edit form, save/delete functionality
3. `src/components/QuickAdd.tsx` exists with native dialog, autoFocus title input, create mutation
4. `src/App.tsx` has N keyboard shortcut listener with input-field guard and dialog guard
5. `src/components/Board.tsx` renders TaskModal with selected task
6. TaskModal uses useMutation for both update and remove
7. QuickAdd uses useMutation for create with defaults (cadence: none, priority: medium)
</verification>

<success_criteria>
- Clicking a task card opens a modal where all fields can be edited
- Saving in the modal updates the task on the board (via Convex reactivity)
- Delete button in modal permanently removes the task
- Pressing N opens quick-add with cursor in title field
- Quick-add creates a task in Inbox with sensible defaults
- Shortcut does not fire when typing in input fields or when a modal is open
- Build compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-task-management/02-02-SUMMARY.md`
</output>
