---
phase: 02-task-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/tasks.ts
  - tsconfig.app.json
  - src/components/TaskCard.tsx
  - src/components/Board.tsx
  - src/components/Column.tsx
  - src/index.css
autonomous: true

must_haves:
  truths:
    - "Tasks created via Convex mutation appear in the Inbox column on the board"
    - "Task cards display a colored left-border indicating priority (green=low, amber=medium, red=high)"
    - "Board fetches real task data from Convex and renders cards in the correct columns"
  artifacts:
    - path: "convex/tasks.ts"
      provides: "Task CRUD functions (list, create, update, remove)"
      exports: ["list", "create", "update", "remove"]
    - path: "src/components/TaskCard.tsx"
      provides: "Task card component with priority color indicator"
      contains: "border-l-4"
    - path: "src/components/Board.tsx"
      provides: "Board fetching real tasks via useQuery and grouping by column"
      contains: "useQuery"
  key_links:
    - from: "src/components/Board.tsx"
      to: "convex/tasks.ts"
      via: "useQuery(api.tasks.list)"
      pattern: "useQuery.*api\\.tasks\\.list"
    - from: "src/components/Column.tsx"
      to: "src/components/TaskCard.tsx"
      via: "renders TaskCard for each task"
      pattern: "TaskCard"
    - from: "convex/tasks.ts"
      to: "convex/schema.ts"
      via: "insert/patch/delete on tasks table"
      pattern: "ctx\\.db\\.(insert|patch|delete)"
---

<objective>
Create the Convex backend functions for task CRUD and wire real task data into the board UI with styled task cards showing priority color indicators.

Purpose: Transforms the static board into a live data-driven board where tasks fetched from Convex render as cards with visual priority indicators. This is the data foundation that all interactive features (modal, quick-add) depend on.

Output: `convex/tasks.ts` with list/create/update/remove functions, `TaskCard.tsx` component with priority-colored borders, and Board/Column components updated to fetch and render real task data.
</objective>

<execution_context>
@/Users/ciciban/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ciciban/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-task-management/02-RESEARCH.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@convex/schema.ts
@src/components/Board.tsx
@src/components/Column.tsx
@src/index.css
@tsconfig.app.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Convex task functions and update TypeScript config</name>
  <files>convex/tasks.ts, tsconfig.app.json</files>
  <action>
Create `convex/tasks.ts` with four exported functions:

1. **`list`** — query that fetches all non-archived tasks. Use `ctx.db.query("tasks").collect()` to return all tasks. The Board will group them client-side by column.

2. **`create`** — mutation accepting `{ title: v.string(), notes: v.optional(v.string()), cadence: v.union(v.literal("daily"), v.literal("weekly"), v.literal("monthly"), v.literal("none")), priority: v.union(v.literal("low"), v.literal("medium"), v.literal("high")) }`. In the handler: compute `searchText = \`${args.title} ${args.notes ?? ""}\`.trim()`, set `column: "inbox"`, set `createdAt` and `updatedAt` to `Date.now()`, leave `completedAt` and `archivedAt` undefined. Return the inserted document ID.

3. **`update`** — mutation accepting `{ id: v.id("tasks"), title: v.optional(v.string()), notes: v.optional(v.string()), cadence: v.optional(...union...), priority: v.optional(...union...) }`. In the handler: fetch existing doc with `ctx.db.get(id)`, throw if not found. Compute updated title and notes (fallback to existing values if not provided), recompute `searchText` from them. Patch the document with provided fields plus `searchText` and `updatedAt: Date.now()`.

4. **`remove`** — mutation accepting `{ id: v.id("tasks") }`. Delete the document with `ctx.db.delete(args.id)`.

Import `query` and `mutation` from `./_generated/server`, `v` from `convex/values`.

Also update `tsconfig.app.json`: change `"lib": ["ES2020", "DOM", "DOM.Iterable"]` to `"lib": ["ES2024", "DOM", "DOM.Iterable"]` so that `Object.groupBy` is recognized by TypeScript (Board.tsx will use it in Task 2).
  </action>
  <verify>
Run `bun run build` — should pass with no TypeScript errors. Verify `convex/tasks.ts` exports `list`, `create`, `update`, `remove`. Verify tsconfig.app.json lib includes ES2024.
  </verify>
  <done>
convex/tasks.ts exists with four exported functions (list, create, update, remove). All mutations recompute searchText. TypeScript lib updated to ES2024. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TaskCard component and wire Board/Column to render real tasks</name>
  <files>src/components/TaskCard.tsx, src/components/Board.tsx, src/components/Column.tsx, src/index.css</files>
  <action>
**TaskCard.tsx** — Create a new component:
- Accept props: `{ task: Doc<"tasks">; onClick: (id: Id<"tasks">) => void }`. Import `Doc` and `Id` from `../convex/_generated/dataModel`.
- Render a div with classes: `bg-card-bg border border-card-border rounded-md p-3 mb-2 border-l-4 cursor-pointer hover:shadow-sm transition-shadow`.
- Apply priority-specific border-left color using a lookup object:
  - `low` → `border-l-priority-low`
  - `medium` → `border-l-priority-medium`
  - `high` → `border-l-priority-high`
- Display task title as `<p className="text-sm font-medium text-slate-800">`.
- If `task.notes` exists and is non-empty, show a truncated preview: `<p className="text-xs text-slate-500 mt-1 line-clamp-2">`.
- Attach `onClick={() => onClick(task._id)}` to the outer div.

**index.css** — Add priority color tokens to the existing `@theme` block:
```
--color-priority-low: #22c55e;
--color-priority-medium: #f59e0b;
--color-priority-high: #ef4444;
```

**Board.tsx** — Replace the static rendering:
- Import `useQuery` from `convex/react` and `api` from `../convex/_generated/api`.
- Import `useState` from `react` (for modal state to be used in Plan 02-02; for now declare `const [selectedTaskId, setSelectedTaskId] = useState<Id<"tasks"> | null>(null)` — import `Id` from `../convex/_generated/dataModel`).
- Call `const tasks = useQuery(api.tasks.list)`.
- Handle loading: if `tasks === undefined`, render a centered "Loading..." message.
- Group tasks: `const tasksByColumn = Object.groupBy(tasks, (t) => t.column)`.
- Pass `tasks={tasksByColumn[col.id] ?? []}` and `onTaskClick={setSelectedTaskId}` to each Column.
- Keep the existing COLUMNS constant and ColumnId export.

**Column.tsx** — Update to render task cards:
- Import `TaskCard` from `./TaskCard`.
- Import `Doc` and `Id` from `../convex/_generated/dataModel`.
- Update props to: `{ id: string; label: string; tasks: Doc<"tasks">[]; onTaskClick: (id: Id<"tasks">) => void }`.
- Replace the "No tasks yet" empty state: if `tasks.length === 0`, show the empty state. Otherwise, map over tasks and render `<TaskCard key={task._id} task={task} onClick={onTaskClick} />`.
- Remove the underscore prefix from `_id` since it will be used for future phases.
  </action>
  <verify>
Run `bun run build` — should pass with no TypeScript errors. Verify TaskCard.tsx exists and contains `border-l-4` and the priority color classes. Verify Board.tsx contains `useQuery(api.tasks.list)` and `Object.groupBy`. Verify Column.tsx renders TaskCard components. Verify index.css contains the three priority color tokens.
  </verify>
  <done>
TaskCard renders with priority-colored left border (green/amber/red). Board fetches tasks from Convex via useQuery and groups by column. Column renders TaskCard list with empty state fallback. Priority color tokens defined in CSS theme. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `bun run build` passes with zero errors
2. `convex/tasks.ts` exports list, create, update, remove functions
3. `src/components/TaskCard.tsx` exists with border-l-4 priority colors
4. `src/components/Board.tsx` uses useQuery(api.tasks.list) and Object.groupBy
5. `src/components/Column.tsx` renders TaskCard components and accepts tasks prop
6. `src/index.css` contains --color-priority-low, --color-priority-medium, --color-priority-high
7. `tsconfig.app.json` lib includes ES2024
</verification>

<success_criteria>
- Convex functions for task CRUD are defined and type-safe
- Board renders real task data from Convex (empty board if no tasks yet)
- Task cards show colored left border matching their priority level
- Build compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-task-management/02-01-SUMMARY.md`
</output>
