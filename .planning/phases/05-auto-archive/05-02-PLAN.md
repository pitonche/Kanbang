---
phase: 05-auto-archive
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/ArchiveView.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to an Archived view that shows all archived tasks separate from the board columns"
    - "User can search and browse archived tasks within the Archived view"
    - "User can click an archived task to view its details in the TaskModal"
    - "Keyboard shortcut N only opens QuickAdd on the board view, not in the archive view"
    - "Keyboard shortcut / focuses the search input on both views"
  artifacts:
    - path: "src/components/ArchiveView.tsx"
      provides: "Archive view with search and task list"
      contains: "listArchived"
    - path: "src/App.tsx"
      provides: "View switching between board and archive with nav UI"
      contains: "AppView"
  key_links:
    - from: "src/components/ArchiveView.tsx"
      to: "convex/tasks.ts (listArchived)"
      via: "useQuery"
      pattern: "useQuery.*listArchived"
    - from: "src/App.tsx"
      to: "src/components/ArchiveView.tsx"
      via: "conditional rendering based on view state"
      pattern: "view.*===.*archive"
    - from: "src/components/ArchiveView.tsx"
      to: "src/components/SearchBar.tsx"
      via: "reused SearchBar component for archive search"
      pattern: "SearchBar"
---

<objective>
Create the Archive view component and wire view switching into App.tsx so users can navigate between the board and a dedicated archive view with search and browse capabilities.

Purpose: ARCH-03 and ARCH-04 -- User can access a separate Archived view and search/browse archived tasks within it.
Output: ArchiveView component, App.tsx with view switching nav and conditional rendering.
</objective>

<execution_context>
@/Users/ciciban/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ciciban/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-auto-archive/05-RESEARCH.md
@.planning/phases/05-auto-archive/05-01-SUMMARY.md

@src/App.tsx
@src/components/Board.tsx
@src/components/SearchBar.tsx
@src/components/TaskModal.tsx
@src/hooks/useDebounce.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ArchiveView component</name>
  <files>src/components/ArchiveView.tsx</files>
  <action>
  Create `src/components/ArchiveView.tsx` with:

  1. **Props interface:** `{ onSearchInputRef?: (el: HTMLInputElement | null) => void }` -- same pattern as Board for "/" shortcut focus wiring.

  2. **State and queries:**
     - `useQuery(api.tasks.listArchived)` for archived tasks.
     - `useState("")` for searchTerm.
     - `useDebounce(searchTerm, 300)` for debounced filtering.
     - `useState<Id<"tasks"> | null>(null)` for selectedTaskId.

  3. **Client-side search filtering:**
     - If `debouncedTerm.trim()` is non-empty, filter `archivedTasks` by checking if `task.searchText.toLowerCase().includes(debouncedTerm.trim().toLowerCase())`.
     - Otherwise show all archived tasks.

  4. **Layout:**
     - Same `flex flex-col min-h-screen bg-board-bg` wrapper as Board for visual consistency.
     - Toolbar row with SearchBar (reuse existing component, pass `value`, `onChange`, `inputRef={onSearchInputRef}`).
     - Count display: `"{filtered.length} archived task(s)"` in `text-xs text-slate-500`.
     - Scrollable list of archived task items in `space-y-2 max-w-2xl` container.
     - Each task: a `<button>` with full-width, text-left, white bg, rounded border, showing title and truncated notes. Add `archivedAt` date display: format as locale date string in `text-xs text-slate-400`.
     - `onClick` sets `selectedTaskId`.

  5. **TaskModal integration:** Render `<TaskModal task={selectedTask} onClose={() => setSelectedTaskId(null)} />` at the bottom. Find selectedTask from the archivedTasks array.

  6. **Loading state:** If `archivedTasks === undefined`, show "Loading..." text.

  7. **Empty state:** If `filtered.length === 0` and no search active, show "No archived tasks yet". If search active with no results, show "No archived tasks match [term]".

  Imports needed: `useState` from react, `useQuery` from convex/react, `api` from convex generated, `Doc` and `Id` types from convex dataModel, `SearchBar`, `TaskModal`, `useDebounce`.
  </action>
  <verify>Run `npx tsc --noEmit` to verify the new component compiles without errors.</verify>
  <done>ArchiveView.tsx exists with searchable archived task list, TaskModal integration, and search input ref forwarding.</done>
</task>

<task type="auto">
  <name>Task 2: Add view switching and navigation to App.tsx</name>
  <files>src/App.tsx</files>
  <action>
  Modify `src/App.tsx` (which already has the archive mount trigger from Plan 01):

  1. **Import ArchiveView:** `import { ArchiveView } from "./components/ArchiveView";`

  2. **View state:** Add `type AppView = "board" | "archive";` and `const [view, setView] = useState<AppView>("board");` near the top of the component.

  3. **Nav header:** Add a nav bar above the conditional view rendering. Structure:
     - `<nav>` element with `flex items-center gap-6 px-6 py-3 bg-white border-b border-slate-200`.
     - App title: `<span className="text-lg font-bold text-slate-800">Kanbang</span>`.
     - Two nav buttons: "Board" and "Archive".
       - Active button: `text-sm font-medium text-slate-800 border-b-2 border-slate-800 pb-0.5`.
       - Inactive button: `text-sm text-slate-500 hover:text-slate-700 pb-0.5`.
       - Each `onClick` calls `setView("board")` or `setView("archive")`.

  4. **Conditional view rendering:** Replace the current `<Board ... />` with:
     ```
     {view === "board" ? (
       <Board onSearchInputRef={(el) => { searchInputRef.current = el; }} />
     ) : (
       <ArchiveView onSearchInputRef={(el) => { searchInputRef.current = el; }} />
     )}
     ```

  5. **QuickAdd guard:** Wrap QuickAdd rendering with `{view === "board" && <QuickAdd ... />}` so it only appears on the board view.

  6. **Keyboard shortcut guard for "N":** In the existing `useEffect` keydown handler, add a check: only trigger QuickAdd (`setQuickAddOpen(true)`) when `view === "board"`. The "/" shortcut should work on both views (already does via searchInputRef). The `useEffect` dependency array must include `view`.

  7. **Keep the archive trigger useEffect** from Plan 01 intact -- do not modify it.
  </action>
  <verify>Run `npx tsc --noEmit` to verify no type errors. Open the app in the browser:
  - Confirm the nav bar appears with "Board" and "Archive" links.
  - Click "Archive" -- confirm the Archive view renders with search bar and any archived tasks.
  - Click "Board" -- confirm the board view renders as before.
  - Press "N" on the board -- QuickAdd opens. Press "N" on Archive view -- nothing happens.
  - Press "/" on either view -- search input focuses.
  </verify>
  <done>App.tsx has view switching between Board and ArchiveView with nav UI. QuickAdd only appears on board view. "N" shortcut guarded to board view only. "/" works on both views.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors.
2. Archive view accessible via nav link -- shows archived tasks in a searchable list.
3. Typing in the Archive view search bar filters archived tasks by title/notes content.
4. Clicking an archived task opens the TaskModal with its details.
5. "N" shortcut only opens QuickAdd on the Board view, not on the Archive view.
6. "/" shortcut focuses the search input on both views.
7. Board view still functions identically (drag-and-drop, search, cadence filters).
</verification>

<success_criteria>
- ArchiveView.tsx renders archived tasks from `listArchived` query with client-side search filtering
- App.tsx has `useState<AppView>` toggling between "board" and "archive" views
- Nav bar with "Board" and "Archive" links with active state styling
- TaskModal works in Archive view for viewing task details
- QuickAdd only renders on board view
- "N" shortcut guarded to board view only
- "/" shortcut works on both views
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/05-auto-archive/05-02-SUMMARY.md`
</output>
