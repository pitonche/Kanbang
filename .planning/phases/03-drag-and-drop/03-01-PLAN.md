---
phase: 03-drag-and-drop
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - convex/tasks.ts
  - src/components/TaskCardOverlay.tsx
autonomous: true

must_haves:
  truths:
    - "moveToColumn mutation sets column, updatedAt, and completedAt (when column is done)"
    - "moveToColumn mutation clears completedAt when moving out of done"
    - "TaskCardOverlay renders a task card without any drag hooks"
  artifacts:
    - path: "convex/tasks.ts"
      provides: "moveToColumn mutation"
      exports: ["moveToColumn"]
      contains: "moveToColumn"
    - path: "src/components/TaskCardOverlay.tsx"
      provides: "Presentational task card for DragOverlay"
      exports: ["TaskCardOverlay"]
    - path: "package.json"
      provides: "dnd-kit dependencies"
      contains: "@dnd-kit/core"
  key_links:
    - from: "convex/tasks.ts"
      to: "convex/schema.ts"
      via: "column union type matches schema definition"
      pattern: "v\\.literal.*done"
---

<objective>
Install dnd-kit packages, add the Convex moveToColumn mutation with completedAt business logic, and create the presentational TaskCardOverlay component.

Purpose: Lay the foundation for drag-and-drop wiring -- the mutation handles the server-side column move (including Done timestamp logic), and the overlay component is needed by DragOverlay to avoid rendering sortable hooks inside the overlay.
Output: dnd-kit installed, moveToColumn mutation deployed, TaskCardOverlay.tsx ready for Board.tsx to import.
</objective>

<execution_context>
@/Users/ciciban/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ciciban/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@convex/tasks.ts
@convex/schema.ts
@src/components/TaskCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dnd-kit packages and add moveToColumn mutation</name>
  <files>package.json, convex/tasks.ts</files>
  <action>
1. Install dnd-kit packages using bun (project uses bun as package manager):
   ```bash
   bun add @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
   ```

2. In `convex/tasks.ts`, add a new `moveToColumn` mutation after the existing `remove` mutation. The mutation must:
   - Accept args: `id: v.id("tasks")` and `column` using the same `v.union(v.literal(...))` pattern as the schema's column field (inbox, backlog, in_progress, needs_info, blocked, done)
   - Set `column` and `updatedAt: Date.now()`
   - If `column === "done"`: set `completedAt = Date.now()`
   - If `column !== "done"`: set `completedAt = undefined` (clears it when moving out of Done)
   - Use `ctx.db.patch(args.id, updates)` (same pattern as existing `update` mutation)
   - Do NOT recompute searchText (column move doesn't change title/notes)

Import pattern matches existing code: `mutation` is already imported from `./_generated/server`.
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Check that `@dnd-kit/core`, `@dnd-kit/sortable`, and `@dnd-kit/utilities` appear in package.json dependencies.
  </verify>
  <done>dnd-kit packages installed in package.json, moveToColumn mutation exists in convex/tasks.ts with correct completedAt logic for Done column.</done>
</task>

<task type="auto">
  <name>Task 2: Create TaskCardOverlay presentational component</name>
  <files>src/components/TaskCardOverlay.tsx</files>
  <action>
Create `src/components/TaskCardOverlay.tsx` as a presentational-only component (NO drag hooks). This component is rendered inside DragOverlay and must NOT use useSortable or any dnd-kit hooks (that would cause duplicate IDs).

The component should:
- Accept a single prop: `task: Doc<"tasks">` (import Doc from `../../convex/_generated/dataModel`)
- Render the same visual structure as TaskCard but with `shadow-lg` added for elevated drag appearance
- Reuse the same `priorityBorder` map as TaskCard: `{ low: "border-l-priority-low", medium: "border-l-priority-medium", high: "border-l-priority-high" }`
- Use the same Tailwind classes as TaskCard for visual consistency: `bg-card-bg border border-card-border rounded-md p-3 border-l-4`
- Add `shadow-lg` and `rotate-[2deg]` for the "picked up" visual feel
- Display task.title and optionally task.notes (same truncation as TaskCard: `line-clamp-2`)
- Export as named export: `export function TaskCardOverlay`
  </action>
  <verify>
Run `npx tsc --noEmit` to confirm no type errors. Verify the file exists and exports TaskCardOverlay.
  </verify>
  <done>TaskCardOverlay.tsx exists with presentational card matching TaskCard visuals plus shadow-lg elevation, no drag hooks.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `@dnd-kit/core`, `@dnd-kit/sortable`, `@dnd-kit/utilities` in package.json dependencies
3. `convex/tasks.ts` exports `moveToColumn` mutation with completedAt logic
4. `src/components/TaskCardOverlay.tsx` exports `TaskCardOverlay` with no dnd-kit imports
</verification>

<success_criteria>
- dnd-kit packages are installed and importable
- moveToColumn mutation correctly handles the Done column timestamp logic
- TaskCardOverlay is a clean presentational component ready for DragOverlay use
- TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/03-drag-and-drop/03-01-SUMMARY.md`
</output>
